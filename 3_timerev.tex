時間反転集束法では，観測波形を時間反転して媒体へ入力し，時間を遡る方向へ散乱波の伝播を調べる．
これを実験や数値シミュレーションで行う場合，時間反転波形をどのような物理量として入力するか
考える必要がある．ここでは，前節の観測波形を時間反転し，表面力として数値解析モデルに与える．
これは，フルウェーブインバージョン(full waveform inversion: FWI)における随伴場を
計算することに相当する．そこで本節では，動弾性問題の基礎方程式とFWIにおける随伴問題の
定式化をはじめに示す．次に，観測波形を境界値に用いた随伴問題の解析結果を示し，
散乱源への波動場の集束状況を調べる．数値波動解析は全て二次元(面内波)問題として行い，
ベクトルやテンソル成分は総和規約を適用した表現を用いる．以下では，随伴問題の解である
随伴場を，より物理的意味を想起しやすいという面を重視し，時間反転場と呼ぶことにする．
\begin{figure}[tbh]
\centering
	\includegraphics[clip,scale=0.55]{Figs/sim_model.eps}
	\caption{解析対象領域．各部の寸法はスリットが無いことを除き
	{\bf 図}-\ref{fig:model}の試験体断面と同じ．}
	\label{fig:fd_model}
\end{figure}
\subsection{動弾性問題の基礎式}
{\bf 図}-\ref{fig:fd_model}に示すような，試験体形状に合わせた領域$G$，
時間範囲$T=(0,\, t_f)$における超音波の伝播・散乱問題を，均質な線形弾性体における
動弾性問題として考える．ここで，位置ベクトルを$\boldsymbol{x}=(x_1,x_2)$，時間変数を$t$とし，
物体力は働かず材料減衰は無視できるとする．
%なお，座標系は原点位置を含め実験と一致させ$(x,y)=(x_1,x_2)$とし，
%指標を使った成分表記が必要である場合を除き$(x,y)$で書く．
いま，応力テンソルを$\sigma_{ij}$, 速度ベクトルを$v_i$，
質量密度を$\rho$とすれば，運動方程式は
\begin{equation}
	\rho \dot{v}_i=\sigma_{ji,j}, \ \ (\boldsymbol{x},t)\in G\times T
	\label{eqn:}
\end{equation}
と表される．ただし$(,)$は空間の，$\dot{()}$は時間の微分
を表す．速度$v_i$は変位ベクトル$u_i$の時間微分で与えられ，
ひずみテンソル$\varepsilon_{ij}$は，変位を使って
\begin{equation}
	\varepsilon_{ij}=\frac{1}{2}(u_{i,j}+u_{j,i})
	\label{eqn:FWD}
\end{equation}
と表される．ここで，弾性係数テンソルを$C_{ijkl}$とすれば，フック則は
\begin{equation}
	\sigma_{ij}=C_{ijkl}\varepsilon_{kl}
	\label{eqn:}
\end{equation}
と表され，等方性体では，ラメ定数$\lambda$と$\mu$を用い
\begin{equation}
	C_{ijkl}=\lambda \delta_{ij}\delta_{kl} +
	\mu (
	\delta_{ik}\delta_{jl}
	+
	\delta_{il}\delta_{jk} 
	)
	\label{eqn:Cijkl_iso}
\end{equation}
とすることができる．このとき，縦波および横波の位相速度は，それぞれ，
\begin{equation}
	c_{L}=\sqrt{\frac{\lambda + 2\mu}{\rho}}
	, \ \ 
	c_{T}=\sqrt{\frac{\mu}{\rho}}
	\label{eqn:}
\end{equation}
となる．$t=0$を超音波の送信時刻とすれば，初期条件は
\begin{equation}
	u_i(\boldsymbol{x},0)=0, 
\ \ v_i(\boldsymbol{x},0)=0, 
\ \ \boldsymbol{x} \in G
	\label{eqn:IC}
\end{equation}
としてよい．超音波の励起は領域境界$\partial G$の一部である$S$に加えた
表面力$\bar{t}_i^{(n)}$で行われ，それ以外の箇所$\partial G\setminus S$で
表面力はゼロとする．このとき，境界条件は次のように表される．
\begin{equation}
	t_i^{(n)} = \sigma_{ji}n_j=
	\left\{
		\begin{array}{ll}	
			\bar{t}^{(n)}_i, & (\fat{x},t)\in S\times T \\
			0,  & (\boldsymbol{x},t)\in \left( (\partial G \setminus S)\times T\right) 
		\end{array}
	\right.
	\label{eqn:BC}
\end{equation}
なお，$n_i$は外向きの単位法線ベクトルを表す．
\\
\hspace{\parindent}
以上の定式化に関する留意事項を述べる．
第一に，解析領域$G$は継手周辺部分の試験体断面を型どったもので，
試験体全体をモデル化したものではない．
第二に，数値解析モデルにはスリットは含まれない．
これは，スリットの無いモデルでの計算結果からスリットの検出
や画像化を行うことがここでの目的となるためである．
最後に，領域$S$に加えられる表面力$\bar{t}_i^{(n)}$は，実際には超音波探触子と試験体の
接触力によって生ずるもので，直接測定できない．
そこで，超音波探触子から入射される波動場を再現する際には，$\bar{t}^{(n)}_i$を
%
境界条件として
%
与えた計算を行うのではなく，プレート裏面側で計測した速度波形を使った計算を行う．
%この点については，第4節であらためて説明する．
その具体的な方法については第4節で説明する．
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{随伴問題(時間反転場の支配方程式)}
超音波探傷で検出すべき欠陥を弾性係数や密度が周囲と異なる領域と
みなせば，$C_{ijkl}$や$\rho$の分布を推定することで欠陥が検出できる．
FWIはこれらのモデルパラメータ:
\begin{equation}
	\fat{m}=\left( \rho, \, C_{ijkl}\right)
	\label{eqn:mprms}
\end{equation}
を推定するために利用することのできる方法の一つである．
FWIでは，観測波形$u_n^{meas}$と，仮定したモデルパラメータ$\fat{m}$
に対して得られるシミュレーション波形$u_n$の差を
% 目的関数$\chi(\fat{m})$と
最小化するよう$\fat{m}$を繰り返し修正して推定する．
%
モデルパラメータの修正には，目的関数$\chi(\fat{m})$を定義し，その勾配
$\nabla \chi(\fat{m})$を用いる．以下に述べるように，$\nabla \chi(\fat{m})$は
時間反転場を用いて表されるFr$\acute{\rm e}$chet Kernelから計算できる．
本研究のRTMイメージングでは，Fr$\acute{\rm e}$chet Kernelを画像化関数として用いる．
%
いま，未知欠陥が領域$G$に含まれるとし，
境界$\partial G$の一部$R\in\partial G$で観測を行い，次のデータを得たとする．
\begin{equation}
	\left\{ 
	\left. 
	u_n^{meas}(\boldsymbol{x},t)\right|  (\boldsymbol{x},t)\in R\times T
	\right\}
	\label{eqn:data}
\end{equation}
ただし，添字$n$は$u_n=u_in_i$，すなわち変位の法線方向成分を表す．
ここで，動弾性問題の解として得られた$R$上でのシミュレーション波形を
$u_n(\boldsymbol{x},t)$とし，FWIにおける目的関数を
\begin{equation}
	\chi(\fat{m}):= \frac{1}{2} \int _T\int _R \left|u_n-u_n^{meas}\right|^2 dtdx_1
	\label{eqn:cost}
\end{equation}
としてみる．
このとき,$\chi(\fat{m})$の$\delta \fat{m}=(\delta \rho,\, \delta C_{ijkl})$
方向への次の意味での微分
\begin{equation}
	\nabla \chi (\fat{m})\delta \fat{m} = \lim_{\varepsilon \rightarrow 0}
	\frac{1}{\varepsilon}
	\left\{
		\chi(\fat{m}+\varepsilon \delta \fat{m})
		-
		\chi(\fat{m})
	\right\}, 
	\label{eqn:del_chi}
\end{equation}
は，
\begin{equation}
	\nabla \chi(\fat{m}) = 
	-\int_G K_{\rho}(\fat{x})\delta \rho dv
	- 
	\int_G K_{ijkl}(\fat{x}) \delta C_{ijkl} dv
	\label{eqn:}
\end{equation}
の形で表される．
%
なお，$(\rho,C_{ijkl})$はモデルパラメータの現在の推定値を，
$(\delta \rho, \delta C_{ijkl})$は修正量であることを意味する．
%
$K_\rho(\fat{x})$と$K_{ijkl}(\fat{x})$はFr$\acute{\rm e}$chet 
kernelと呼ばれ，随伴問題の解$u^{\dagger}(\fat{x},t)$を用いて次のように与えられる\cite{Fichtner}．
\begin{eqnarray}
	K_\rho(\fat{x}) &= & \int _T \dot{u}_i \dot{u}^{\dagger}_i dt 
	\label{eqn:K_rho}
	\\
	K_{ijkl}(\fat{x}) &= & \int _T u_{i,j} u^{\dagger}_{k,l} dt 
	\label{eqn:K_ijkl}
\end{eqnarray}
ここで，$u_i^{\dagger}$を解にもつ随伴問題は，次の終端値-境界値問題として
定式化される．
\begin{itemize}
\item
支配方程式:
\begin{equation}
	%\rho \ddot{u}_i^{\dagger} =
	\rho \ddot{u}_i^{\dagger}(\fat{x},t) =
	%\sigma^{\dagger}_{ji,j}, \ \ 
	\sigma^{\dagger}_{ji,j}(\fat{x},t), \ \ 
	(\fat{x},t) \in G\times T
	\label{eqn:wveq_adj}
\end{equation}
ただし，
\begin{equation}
	%\sigma_{ij}^{\dagger}= C_{ijkl}u_{k,l}^{\dagger}.
	\sigma_{ij}^{\dagger}(\fat{x},t)= C_{ijkl}u_{k,l}^{\dagger}(\fat{x},t).
	\label{eqn:sigma_dgg}
\end{equation}
\item 
終端条件:
\begin{equation}
	u_i^{\dagger}(\fat{x},t_f) =0,  \ \
	\dot{u}_i^{\dagger}(\fat{x},t_f) =0,  \ \, \fat{x}\in G
	\label{eqn:IC_adj}
\end{equation}
\item
境界条件:
\begin{equation}
	t_i^{(n)\dagger}
	=
%	\sigma_{ji}^{\dagger}(\fat{x},t)n_j(\fat{x}) =
	\left\{
		\begin{array}{ll}
			(
			u_n^{meas}(\fat{x},t)
			-
			u_n(\fat{x},t)
			)n_i(\fat{x}), & \fat{x}\in R \\
			0, & \hspace{-3mm} \fat{x} \in \partial G\setminus R
		\end{array}
	\right.
	\label{eqn:BC_adj}
\end{equation}
ただし，$t_i^{(n)\dagger}=t_i^{(n)\dagger}(\fat{x},t)=\sigma_{ji}^{\dagger}(\fat{x},t)n_j(\fat{x})$．
\end{itemize}
式(\ref{eqn:wveq_adj})-(\ref{eqn:BC_adj})で表される随伴問題は，
時間反転：
\begin{equation}
	\tau=t_f-t
	\label{eqn:tau_def}
\end{equation}
により，$\tau$を新しい時間変数とすれば，弾性波の初期値-境界値問題に帰着される．
ただし，物理的な時間$t$に関して時間を遡る方向に問題を解くことに変わりはないため，
随伴場$u_i^{\dagger}(\fat{x},\tau)$は時間反転場とみなすことができる．
\subsection{時間反転場の数値解析法と計算条件}
時間反転場，すなわち，随伴問題(\ref{eqn:wveq_adj})-(\ref{eqn:BC_adj})の数値解析
には2次元FDTD法\cite{Fellinger1995, FDTD_KK}を用いる．
解析領域は図-\ref{fig:fd_model}とし，実験時の波形観測領域$R$に，
時間反転波形を表面力として加える．ただし，解析領域の打ち切り位置で実験では生じない
反射波が発生することを避けるため，プレートとリブの打ち切り位置には，厚さ15mmのPML吸収領域を設ける．
モデルパラメータであるラメ定数$\lambda,\mu$と密度$\rho$は，
実測したアルミニウム試験体の位相速度
\begin{equation}
	c_L=6.35{\rm km/s}, \ \ c_T=3.15{\rm km/s}
	\label{eqn:phase_vels}
\end{equation}
と，密度の文献値$\rho=2.7{\rm g/cm}^3$を与える．
FDTD法における空間と時間の離散化幅$h$と$\Delta t$は，それぞれ，
\begin{equation}
	h=0.05{\rm mm}, \ \ \Delta t=3{\rm ns}
	\label{eqn:}
\end{equation}
とし，解析時間範囲は$T=(0,t_f)=(0,45)\mu$s，空間範囲は媒体$G$を含む,
幅90mm高さ35mmの矩形領域とした．なお，空間の離散化では，媒体が存在しない
領域も含めスタガード格子が配置しているが，計算時には使用されない．
以上の設定では，
時間ステップ数$15,000$，空間格子数は未知量あたり1,800$\times$700となる．
%
%$t_f=45\mu$s以後の時刻にも，右方向への強い進行波があるが，
%それらはスリットの有無に関わらず現れ，強度も左進行波と同程度
%であることからスリットに起因したものである可能性は低い．
%このことから，ここでは，
%
\\
\hspace{\parindent}
随伴問題の境界条件(\ref{eqn:BC_adj})において，$u_n^{meas}$には実験で得られた
超音波波形を用いる．
\begin{figure}[thb]
\centering
	\includegraphics[clip,scale=0.5]{Figs/kwfilted_xt.eps}
	\caption{観測波形から抽出した(a)左進行波と(b)右進行波.(c)は表面波成分除去後の右進行波．}
	\label{fig:kwfilted_xt}
\end{figure}
%順問題の解である$u_n(\fat{x},t)$には，入射波変位$u_n^{in}$を与えることが望ましい．
%それが可能である場合，$u_n^{meas}$は全変位だから,$u_n-u_n^{meas}$が散乱波となり，
%時間反転場には散乱源に戻る波動場が明瞭に現れる．
順問題の解である$u_n(\fat{x},t)$はスリットがない場合の変位場だから，
これを入射場とすれば$u_n^{meas}-u_n$は散乱波を意味し，
時間反転場には散乱源に戻る波動場が現れると期待される．
%
しかしながら，実測波形にはノイズが含まれること，
本来3次元的な問題を計算コストを抑えるために2次元問題として扱っていることから，
実測波形に含まれる入射波成分を
%
シミュレーション波形を使って
%
正確に差し引くことは難しい．
とりわけLDV計測では，試料の表面状態に応じた受光強度の変化があり，その補正も考慮した
入射波成分の特定は困難である．そこで本研究では，スリットから受信点側に伝わる,右($x_1>0$)
方向進行波を散乱波とみなし，時間反転場の計算に用いる．
すなわち，観測波形$u_n^{meas}(x_1,t)$を,
右進行波$u_n^{+}(x_1,t)$と
左進行波$u_n^{-}(x_1,t)$の和として
\begin{equation}
	u_n^{meas}(x_1,t)=u_n^{+}(x_1,t)+u_n^{-}(x_1,t)
	\label{eqn:split}
\end{equation}
で表し，$u_n^+=-(u_n^{-}-u_n^{meas})$を時間反転場解析の
境界値(\ref{eqn:BC_adj})に用いる．
%
なお，観測面$R$上で$x_2$は一定のため，$u_n^{\pm}$等の引数から$x_2$は省略している．
%
式(\ref{eqn:split})の分離は，観測波形を2次元フーリエ変換して
波数-周波数スペクトル:
\begin{equation}
	U(k,\omega)= \frac{1}{(2\pi)^2} \iint u^{meas}_n(x_1,t)e^{-ikx_1+i\omega t}dtdx_1
	\label{eqn:Ukw}
\end{equation}
を計算し，$k$と$\omega$が同符号のスペクトル成分は$u_n^-$に，
異符号の成分は$u_n^+$に寄与すると考え，帯域制限した次のフーリエ逆変換で求める．
\begin{eqnarray}
	u_n^-(x_1,t) &=& \iint H(-k\omega)U(k,\omega)e^{ikx_1-i\omega t}dk d\omega
	\label{eqn:um} \\
	u_n^+(x_1,t) &=& \iint H(k\omega) U(k,\omega)e^{ikx_1-i\omega t}dk d\omega 
	\label{eqn:up}
\end{eqnarray}
ここで，$H(s)$はヘビサイドステップ関数を表す．
この方法では，入射波成分が大部分を占める左進行波を，
観測波形以外の情報を用いることなく時間反転場解析での
入力波形から取り除くことができる．
{\bf 図}-\ref{fig:kwfilted_xt}の(a)と(b)は，{\bf 図}-\ref{fig:bscans}(a)に示した
速度波形データを$\dot u_n^{meas}(x_1,t)$とし，式(\ref{eqn:Ukw})-(\ref{eqn:up})で計算した
左右進行波成分の速度波形$\dot{u}_n^-(x_1,t),\dot{u}_n^+(x_1,t)$である．
なお，これらのプロットは$\dot u_n^{meas}(x_1,t)$の最大値で規格化されている．
{\bf 図-}\ref{fig:kwfilted_xt}(a)の結果では，右上がりの波群はほとんど見られず，
右進行波$\dot u_n^+$が適切に取り除かれている．
一方，{\bf 図}-\ref{fig:kwfilted_xt}(b)では，
主として右進行波$\dot u_n^{+}$から成ることが確認できるが，
振幅の大きな左進行波の一部が除去しきれていない．
これは，LDV観測における受光強度のばらつきにより，速度波形$u_n^{meas}$に
不規則な空間変動があることが原因として考えられる．
%
なお，{\rm 図}-\ref{fig:bscans}の観測波形では，$50\mu$s以後にも右方向への強い
進行波が現れている．ただしそれらはスリットの有無によらず観測され，
強度も左進行波と同程度であることから，スリットに起因したものである
可能性は低い．このことも考慮し，{\rm 図}-\ref{fig:kwfilted_xt}では，$50\mu$s
までの進行方向分離と表面波成分の除去状況を示している．
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{時間反転場の計算結果}
以上の方法で計算した時間反転場の様子を{\bf 図}-\ref{fig:snap_crack_rwv}に示す．
この図は，速度場$| \dot{\fat{u}}^{\dagger}(\fat{x},t)|$のスナップショットを6つの
時刻$\tau$について示したものである.なお，速度振幅は適度なコントラストで波動場が可視化されるように
スケーリングした相対値として表示されている．ただし,スケーリングの基準値は(a)-(f)のプロット全てに
共通であるため，速度振幅の大小関係はプロット間で互いに比較できる．
\begin{figure}[bth]
\centering
	\includegraphics[clip,scale=0.4]{Figs/SnapCrackRwv.eps}
	\caption{時間反転場のスナップショット(スリットあり)}
	\label{fig:snap_crack_rwv}
\end{figure}
(a)の結果をみると,この時刻では，大きな振幅を持った箇所が表面近傍に集中している．
これは，表面波が大きな振幅をもって伝播していることを示す.
\begin{figure}[t]
\centering
	\includegraphics[clip,scale=0.45]{Figs/kwfilted_kw.eps}
	\caption{計測した速度波形の波数-周波数スペクトル}
	\label{fig:kwfilted_kw}
\end{figure}
やや時間が経過した(b)では，止端部$x_1=0$に達した表面波が回折波を励起している．
止端で発生した回折波は，(b)の時刻以後，継手内をSV波として進展する．このような
回折で生じたSV波は次第に空間的に広がる．その一部は散乱源に達するもののいずれか
の点に集束することはなく, スリットの検出や位置特定にはあまり有効でない．
%
そこで，強い回折波の原因となる表面波成分を，入力波形$u_n^{-}(x_1,t)$から取り除いて
時間反転場解析を行う．表面波の位相速度$c_R$は，等方弾性体の場合$c_L$と$c_T$
から理論的に求められる\cite{Schmerr1999}．また，計測波形の波数-周波数スペクトル
$U(k,\omega)$において，表面波成分は傾き$c_R^{-1}$の直線に沿って分布する．
{\bf 図}-\ref{fig:kwfilted_kw}(a)はこのことをみるために,$|U(k,\omega)|$を
計算してプロットしたもので，横軸を周波数$f=\frac{\omega}{2\pi}$，
縦軸を波数$\xi=\frac{k}{2\pi}$とし，スペクトル振幅を最大値で無次元化して
示している．この中で，傾き$1/c_R=1/2.86$(km/s)$^{-1}$の,原点を通る直線付近の
スペクトル成分が表面波で，非常に狭い範囲に集中していることが分かる．
そこで，この直線に沿って平均位置を移動させながら,標準偏差0.2MHzのガウス型
窓関数を周波数軸上で作用させ，表面波成分を取り除く．{\bf 図}-\ref{fig:kwfilted_kw}(b)は
その結果を示したもので，これを時空間領域にフーリエ逆変換することで
{\bf 図}-\ref{fig:kwfilted_xt}(c)のような走時波形が得られる．
この走時波形には，同図(b)に見られた右上がりの直線的な軌跡を示す表面波が概ね取り除かれている．
そこで，表面波を除去した(c)の速度波形を用いて時間反転場を求めると，
{\bf 図}-\ref{fig:snap_crack}のような結果が得られる．
\begin{figure}[thb]
\centering
	\includegraphics[clip,scale=0.4]{Figs/SnapCrack.eps}
	\caption{時間反転場のスナップショット(スリットあり，表面波成分を事前に除去)}
	\label{fig:snap_crack}
\end{figure}
この図に示す(a)の時刻では，時間反転波形の入力域$R$から発生した縦波が
白の矢印で示す方向に進展している.この縦波はプレート下面で反射され，
(b)の時刻では進行方向を変えて余盛部分に向かっている．続く(c)の時刻では，
余盛り表面に縦波が到達して反射され，横波へのモード変換が起きる．
このようにして生じた横波は,(d)で余盛表面を離れてスリットに向かい，
(e)の時刻を経て次第に集束しながら，(f)の時刻において試験体では
スリットがある位置に到達している．
%
なお，ここに示された散乱波の振動回数が6$\sim$7回程度多いことは，
スリットと切り欠きからのエコーが混在するためと考えられる．
%
以上の観察から，この散乱波の起点がスリットにあり，どのような経路を辿って観測
領域$R$に至ったかが明確に理解できる．このような経路と伝播モードの散乱波が，
十分検出しうる強度で観測波形に含まれることを事前に知ることは困難で，
表面波の除去と時間反転場の計算によってはじめて識別が可能になる．
%このことは，予め経路特定が必要となるイメージング方法では，
%ここで見出された散乱波を利用することができず，時間反転法をベースとした
%イメージング法の適用が必要かつ有効であることを示唆する．
%\\ %\hspace{\parindent}
%スリットの無い試験体で得られた観測波形から同じ手順で表面波を除去し,
%時間反転場解析を行った結果を{\bf 図}-\ref{fig:snap_none}に示す．
%この場合,入力域$R$では横波が発生し，(a)の時刻では白の矢印の方向へ進行し,
%(b)の時刻では底面での反射が起きている.続く (c),(d),(e)では横波のまま
%継手内部を上昇し,最終的には(f)の時刻で切り欠き角部に到達する．
%このように，スリットの有無で時間反転場の挙動は明らかに異なり，
%元々の観測波形({\bf 図}-\ref{fig:bscans})の比較では判然としない
%媒体内部の状況が，時間反転場解析を通じて極めて明瞭に提示されていると言える．
%\begin{figure}[htb]
%\centering
%	\includegraphics[clip,scale=0.4]{Figs/SnapNone.eps}
%	\caption{時間反転場のスナップショット(スリットなし，表面波成分を事前に除去)}
%	\label{fig:snap_none}
%\end{figure}
